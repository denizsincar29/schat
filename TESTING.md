#!/bin/bash
# Manual test guide for schat

echo "=== schat Manual Testing Guide ==="
echo ""
echo "This guide will help you test the SSH chat application."
echo ""
echo "Prerequisites:"
echo "1. PostgreSQL must be running (via docker-compose or locally)"
echo "2. Environment variables must be set (see .env.example)"
echo ""
echo "=== Starting the Application ==="
echo ""
echo "Option 1 - Using Docker Compose:"
echo "  ./setup.sh              # Configure environment"
echo "  docker compose up -d    # Start services"
echo "  docker compose logs -f  # View logs"
echo ""
echo "Option 2 - Running Locally:"
echo "  # Make sure PostgreSQL is running and configured"
echo "  export DB_HOST=localhost"
echo "  export DB_PORT=5432"
echo "  export DB_USER=postgres"
echo "  export DB_PASSWORD=your_password"
echo "  export DB_NAME=schat"
echo "  export SSH_PORT=2222"
echo "  go run main.go"
echo ""
echo "=== Testing User Registration ==="
echo "1. Connect without username:"
echo "   ssh -p 2222 localhost"
echo ""
echo "2. Follow prompts to:"
echo "   - Enter username"
echo "   - Choose authentication (password or SSH key)"
echo "   - Complete registration"
echo ""
echo "=== Testing Authentication ==="
echo "1. Reconnect with your username:"
echo "   ssh -p 2222 user@localhost"
echo ""
echo "2. Enter your password when prompted"
echo ""
echo "=== Testing Chat Commands ==="
echo "Once connected, try these commands:"
echo ""
echo "Basic Commands:"
echo "  /help              - Show all commands"
echo "  /rooms             - List available rooms"
echo "  /join general      - Join the general room"
echo "  /users             - List users in current room"
echo "  Hello, world!      - Send a message"
echo ""
echo "Room Management:"
echo "  /create lounge Welcome to the lounge"
echo "  /join lounge"
echo ""
echo "User Profile:"
echo "  /nick MyNickname   - Set nickname"
echo "  /status Away       - Set status"
echo "  /bell              - Toggle notifications"
echo ""
echo "Messaging:"
echo "  /msg otheruser Hello there"
echo "  /me waves hello"
echo "  @username look at this    - Mention a user"
echo "  /mentions          - View your mentions"
echo ""
echo "=== Testing Admin Commands ==="
echo "First, make a user admin:"
echo "  docker compose exec postgres psql -U postgres -d schat"
echo "  UPDATE users SET is_admin = true WHERE username = 'youruser';"
echo "  \\q"
echo ""
echo "Then test admin commands:"
echo "  /ban username 5m Spamming"
echo "  /mute username 10m Being loud"
echo "  /kick username 2m Violation"
echo "  /unban username"
echo "  /unmute username"
echo ""
echo "=== Testing Multiple Users ==="
echo "1. Open multiple terminals"
echo "2. Connect with different users"
echo "3. Test real-time messaging between them"
echo ""
echo "=== Cleanup ==="
echo "To stop the application:"
echo "  docker compose down         # Stop all services"
echo "  docker compose down -v      # Stop and remove volumes"
echo ""
